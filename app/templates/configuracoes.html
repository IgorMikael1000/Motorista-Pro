{% extends 'base.html' %}

{% block extra_css %}
<style>
    .settings-group {
        background: var(--glass-bg);
        border: var(--glass-border);
        box-shadow: var(--glass-shadow);
        backdrop-filter: var(--backdrop-blur);
        border-radius: var(--radius-card);
        padding: 5px 20px;
        margin-bottom: 25px;
        width: 100%;
    }
    
    .menu-item {
        display: flex; align-items: center; justify-content: space-between;
        padding: 18px 0; border-bottom: 1px solid rgba(0,0,0,0.05);
        text-decoration: none; cursor: pointer; transition: opacity 0.2s; width: 100%;
    }
    .menu-item:last-child { border-bottom: none; }
    .menu-item:active { opacity: 0.6; }
    
    .menu-left { display: flex; align-items: center; gap: 15px; }
    .menu-icon { 
        width: 38px; height: 38px; border-radius: 12px; 
        display: flex; align-items: center; justify-content: center; font-size: 18px;
    }
    .menu-text { font-size: 14px; font-weight: 700; color: var(--text-main); }
    .menu-sub { font-size: 11px; color: var(--text-secondary); display: block; margin-top: 2px; }
    
    /* Switch */
    .switch { position: relative; display: inline-block; width: 45px; height: 24px; }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #cbd5e1; transition: .4s; border-radius: 34px; }
    .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 2px; bottom: 2px; background-color: white; transition: .4s; border-radius: 50%; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
    input:checked + .slider { background-color: var(--primary); }
    input:checked + .slider:before { transform: translateX(21px); }
</style>
{% endblock %}

{% block content %}
<div class="header fade-in">
    <a href="/" class="back-btn"><i class="fas fa-chevron-left"></i></a>
    <div style="flex-grow: 1; text-align: center;">
        <h2 style="margin:0; font-size:18px; color:var(--text-main); font-weight: 800;">Ajustes</h2>
    </div>
    <div style="width:40px;"></div>
</div>

<div class="container fade-in" style="padding-top: 10px; padding-bottom: 120px; animation-delay: 0.1s;">
    
    {% if request.args.get('msg') == 'erro_arquivo' %}
    <div style="background:#FEF2F2; color:#DC2626; padding:10px; border-radius:10px; font-size:12px; font-weight:600; text-align:center; margin-bottom:15px; border:1px solid #FCA5A5;">
        Erro ao importar arquivo.
    </div>
    {% endif %}
    {% if request.args.get('msg') == 'restaurado_ok' %}
    <div style="background:#ECFDF5; color:#059669; padding:10px; border-radius:10px; font-size:12px; font-weight:600; text-align:center; margin-bottom:15px; border:1px solid #6EE7B7;">
        Dados restaurados com sucesso!
    </div>
    {% endif %}

    <!-- PERFIL -->
    <div style="text-align:center; margin-bottom: 30px;">
        <div style="width:80px; height:80px; background:var(--glass-bg); border-radius:50%; display:inline-flex; align-items:center; justify-content:center; font-size:35px; color:var(--primary); box-shadow:var(--glass-shadow); border:var(--glass-border);">
            {% if current_user.profile_image %}
                <img src="{{ current_user.profile_image }}" style="width:100%; height:100%; object-fit:cover; border-radius:50%;">
            {% else %}
                <i class="fas fa-user"></i>
            {% endif %}
        </div>
        <h3 style="margin:10px 0 5px 0; color:var(--text-main); font-weight: 800;">{{ current_user.nome }}</h3>
        <p style="margin:0; color:var(--text-secondary); font-size:13px;">{{ current_user.email }}</p>
    </div>

    <!-- MENU CONTA -->
    <div style="font-size:11px; font-weight:800; color:var(--text-secondary); margin: 0 0 10px 10px; text-transform:uppercase;">Minha Conta</div>
    <div class="settings-group">
        <a href="/dados_pessoais" class="menu-item">
            <div class="menu-left">
                <div class="menu-icon" style="background:rgba(37, 99, 235, 0.1); color:var(--primary);"><i class="fas fa-user-edit"></i></div>
                <div><div class="menu-text">Dados Pessoais</div><span class="menu-sub">Nome e WhatsApp</span></div>
            </div>
            <i class="fas fa-chevron-right" style="color:var(--text-secondary); font-size:12px;"></i>
        </a>
        <a href="/seguranca" class="menu-item">
            <div class="menu-left">
                <div class="menu-icon" style="background:rgba(100, 116, 139, 0.1); color:var(--text-secondary);"><i class="fas fa-shield-alt"></i></div>
                <div><div class="menu-text">Senha e Segurança</div><span class="menu-sub">Alterar e-mail e senha</span></div>
            </div>
            <i class="fas fa-chevron-right" style="color:var(--text-secondary); font-size:12px;"></i>
        </a>
        <a href="/assinatura" class="menu-item">
            <div class="menu-left">
                <div class="menu-icon" style="background:rgba(245, 158, 11, 0.1); color:var(--warning);"><i class="fas fa-crown"></i></div>
                <div><div class="menu-text">Meu Plano</div><span class="menu-sub">Gerenciar assinatura</span></div>
            </div>
            <i class="fas fa-chevron-right" style="color:var(--text-secondary); font-size:12px;"></i>
        </a>
    </div>

    <!-- MENU SISTEMA -->
    <div style="font-size:11px; font-weight:800; color:var(--text-secondary); margin: 0 0 10px 10px; text-transform:uppercase;">App</div>
    <div class="settings-group">
        <div class="menu-item">
            <div class="menu-left">
                <div class="menu-icon" style="background:var(--text-main); color:var(--bg-body);"><i class="fas fa-moon"></i></div>
                <div class="menu-text">Modo Escuro</div>
            </div>
            <label class="switch">
                <input type="checkbox" id="darkModeSwitch" onclick="toggleDarkMode()">
                <span class="slider"></span>
            </label>
        </div>
        
        <a href="/suporte" class="menu-item">
            <div class="menu-left">
                <div class="menu-icon" style="background:rgba(16, 185, 129, 0.1); color:var(--success);"><i class="fas fa-headset"></i></div>
                <div class="menu-text">Suporte / Ajuda</div>
            </div>
            <i class="fas fa-chevron-right" style="color:var(--text-secondary); font-size:12px;"></i>
        </a>
    </div>

    <!-- MENU BACKUP (RESTAURADO) -->
    <div style="font-size:11px; font-weight:800; color:var(--text-secondary); margin: 0 0 10px 10px; text-transform:uppercase;">Backup e Dados</div>
    <div class="settings-group">
        <a href="/exportar" target="_blank" class="menu-item">
            <div class="menu-left">
                <div class="menu-icon" style="background:rgba(37, 99, 235, 0.1); color:var(--primary);"><i class="fas fa-download"></i></div>
                <div><div class="menu-text">Exportar Dados</div><span class="menu-sub">Baixar cópia de segurança (JSON)</span></div>
            </div>
            <i class="fas fa-chevron-right" style="color:var(--text-secondary); font-size:12px;"></i>
        </a>
        
        <div class="menu-item" onclick="document.getElementById('importFile').click()">
            <div class="menu-left">
                <div class="menu-icon" style="background:rgba(16, 185, 129, 0.1); color:var(--success);"><i class="fas fa-file-import"></i></div>
                <div><div class="menu-text">Importar Backup</div><span class="menu-sub">Restaurar dados de arquivo</span></div>
            </div>
            <i class="fas fa-chevron-right" style="color:var(--text-secondary); font-size:12px;"></i>
        </div>
        
        <form action="/configuracoes/importar" method="POST" enctype="multipart/form-data" style="display:none;">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="file" id="importFile" name="file" accept=".json" onchange="if(confirm('Isso substituirá seus dados atuais. Confirmar?')) this.form.submit()">
        </form>
    </div>

    <a href="/logout" style="display:flex; align-items:center; justify-content:center; gap:8px; color:var(--danger); font-weight:700; font-size:13px; margin: 0 0 20px 0; text-decoration:none; opacity:0.8; padding:15px; border-radius:16px; background:rgba(220, 38, 38, 0.05);">
        <i class="fas fa-sign-out-alt"></i> Sair da Conta
    </a>
    
    <a href="/termos" style="display:block; text-align:center; color:var(--text-secondary); font-size:11px; text-decoration:underline; opacity:0.6; margin-bottom: 20px;">
        Termos de Uso e Privacidade
    </a>
</div>

{% block extra_js %}
<script>
    const switchBtn = document.getElementById('darkModeSwitch');
    function toggleDarkMode() {
        const isDark = document.body.classList.toggle('dark-mode');
        localStorage.setItem('darkMode', isDark);
        document.cookie = "darkMode=" + isDark + "; path=/; max-age=31536000";
    }
    if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark-mode');
        if(switchBtn) switchBtn.checked = true;
    }
</script>
{% endblock %}
{% endblock %}


